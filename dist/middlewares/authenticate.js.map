{"version":3,"sources":["../../server/middlewares/authenticate.js"],"names":["jwt","User","req","res","next","header","headers","authorization","token","split","verify","process","env","JWT_SECRET","err","decoded","status","json","errors","global","findOne","email","then","user","currentUser"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,OAAOC,IAAP,MAAiB,gBAAjB;;AAEA,gBAAe,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACjC,QAAMC,SAASH,IAAII,OAAJ,CAAYC,aAA3B;AACA,MAAIC,KAAJ;;AAEA,MAAIH,MAAJ,EAAYG,QAAQH,OAAOI,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAR;;AAEZ,MAAID,KAAJ,EAAW;AACTR,QAAIU,MAAJ,CAAWF,KAAX,EAAkBG,QAAQC,GAAR,CAAYC,UAA9B,EAA0C,CAACC,GAAD,EAAMC,OAAN,KAAkB;AAC1D,UAAID,GAAJ,EAAS;AACPX,YAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,QAAQ,EAAEC,QAAQ,eAAV,EAAV,EAArB;AACD,OAFD,MAEO;AACLlB,aAAKmB,OAAL,CAAa,EAAEC,OAAON,QAAQM,KAAjB,EAAb,EAAuCC,IAAvC,CAA4CC,QAAQ;AAClDrB,cAAIsB,WAAJ,GAAkBD,IAAlB;AACAnB;AACD,SAHD;AAID;AACF,KATD;AAUD,GAXD,MAWO;AACLD,QAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,QAAQ,EAAEC,QAAQ,UAAV,EAAV,EAArB;AACD;AACF,CApBD","file":"authenticate.js","sourcesContent":["import jwt from \"jsonwebtoken\";\nimport User from \"../models/User\";\n\nexport default (req, res, next) => {\n  const header = req.headers.authorization;\n  let token;\n\n  if (header) token = header.split(\" \")[1];\n\n  if (token) {\n    jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {\n      if (err) {\n        res.status(401).json({ errors: { global: \"Invalid token\" } });\n      } else {\n        User.findOne({ email: decoded.email }).then(user => {\n          req.currentUser = user;\n          next();\n        });\n      }\n    });\n  } else {\n    res.status(401).json({ errors: { global: \"No token\" } });\n  }\n};"]}